{% extends 'base.html' %}
{% block title %}Редактировать товар{% endblock %}
{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8">
    <div class="card shadow-lg fade-in">
      <div class="card-body p-4">
        <h4 class="card-title mb-4 text-center">
          <i class="fa-solid fa-pen-to-square text-primary me-2"></i>Редактировать товар
        </h4>
        <form method="post" enctype="multipart/form-data" class="row g-4">
          <div class="col-md-6">
            <label class="form-label">Название</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-tag"></i></span>
              <input type="text" name="name" class="form-control" value="{{ item.name }}" placeholder="Введите название товара" required>
            </div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Количество</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-hashtag"></i></span>
              <input type="number" name="quantity" class="form-control" value="{{ item.quantity }}" placeholder="Введите количество" min="0" required>
            </div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Оптовая цена</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-money-bill-wave"></i></span>
              <input type="number" step="0.01" name="wholesale_price" class="form-control" value="{{ item.wholesale_price }}" placeholder="Введите оптовую цену" min="0" required>
            </div>
          </div>

          <div class="col-md-6">
            <label class="form-label">Розничная цена</label>
            <div class="input-group">
              <span class="input-group-text"><i class="fa-solid fa-hand-holding-dollar"></i></span>
              <input type="number" step="0.01" name="retail_price" class="form-control" value="{{ item.retail_price }}" placeholder="Введите розничную цену" min="0" required>
            </div>
          </div>

          <div class="col-12">
            <label class="form-label">Фото товара</label>
            <div class="border rounded-3 p-3 bg-light">
              <div class="d-flex flex-column flex-md-row gap-3 align-items-start">
                <div class="flex-grow-1">
                  <input type="file" name="image" class="form-control" accept="image/*" onchange="previewImageEdit()">
                  <div class="form-text">Оставьте пустым, чтобы сохранить текущее фото</div>
                </div>
                <div class="d-flex flex-column align-items-center">
                  <span class="small text-muted mb-1">Текущее фото:</span>
                  <img src="{{url_for('serve_image', filename=item.filename)}}" alt="Текущее фото" class="img-thumbnail" style="max-width:120px; height:90px; object-fit:cover;">
                </div>
                <div class="d-flex flex-column align-items-center d-none" id="preview-edit-container">
                  <span class="small text-muted mb-1">Новое фото:</span>
                  <img id="image-preview-edit" class="img-thumbnail" style="max-width:120px; height:90px; object-fit:cover;">
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 mt-2">
            <div class="d-flex justify-content-between">
              <a href="{{ url_for('history') }}" class="btn btn-outline-secondary">
                <i class="fa-solid fa-arrow-left me-1"></i> Назад
              </a>
              <button class="btn btn-primary px-4">
                <i class="fa-solid fa-save me-1"></i> Сохранить изменения
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function previewImageEdit() {
  const preview = document.getElementById('image-preview-edit');
  const container = document.getElementById('preview-edit-container');
  const file = document.querySelector('input[type=file][name=image]').files[0];
  if (!file) { container.classList.add('d-none'); return; }
  const reader = new FileReader();
  reader.onloadend = function() {
    preview.src = reader.result;
    container.classList.remove('d-none');
  }
  reader.readAsDataURL(file);
}
</script>
{% endblock %}
