{% extends 'base.html' %}
{% block title %}Редактировать товар{% endblock %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h4 class="card-title mb-3"><i class="fa-solid fa-pen me-2 text-primary"></i>Редактировать товар</h4>
    <form method="post" enctype="multipart/form-data" class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Название</label>
        <input type="text" name="name" class="form-control" value="{{ item.name }}" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">Количество</label>
        <input type="number" name="quantity" class="form-control" value="{{ item.quantity }}" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">Оптовая цена</label>
        <input type="number" step="0.01" name="wholesale_price" class="form-control" value="{{ item.wholesale_price }}" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">Розничная цена</label>
        <input type="number" step="0.01" name="retail_price" class="form-control" value="{{ item.retail_price }}" required>
      </div>

      <div class="col-12">
        <label class="form-label">Новое фото (опционально)</label>
        <input type="file" name="image" class="form-control" accept="image/*" onchange="previewImageEdit()">
        <div class="mt-2">
          <span class="small text-muted">Текущее фото:</span>
          <img src="{{url_for('serve_image', filename=item.filename)  }}" alt="current" class="img-thumbnail" style="max-width:120px;">
        </div>
        <div class="mt-2 d-none" id="preview-edit-container">
          <img id="image-preview-edit" class="img-thumbnail" style="max-width:160px;">
        </div>
      </div>

      <div class="col-12 d-flex justify-content-end">
        <button class="btn btn-primary"><i class="fa-solid fa-save me-1"></i> Сохранить изменения</button>
      </div>
    </form>
  </div>
</div>

<script>
function previewImageEdit() {
  const preview = document.getElementById('image-preview-edit');
  const container = document.getElementById('preview-edit-container');
  const file = document.querySelector('input[type=file][name=image]').files[0];
  if (!file) { container.classList.add('d-none'); return; }
  const reader = new FileReader();
  reader.onloadend = function() {
    preview.src = reader.result;
    container.classList.remove('d-none');
  }
  reader.readAsDataURL(file);
}
</script>
{% endblock %}
